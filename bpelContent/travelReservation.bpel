<!-- travelReservation BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue Sep 20 19:04:48 ECT 2011 -->
<bpel:process name="travelReservation" targetNamespace="http://ndeveloper.com/bpel/travel"
	suppressJoinFailure="yes" xmlns:tns="http://ndeveloper.com/bpel/travel"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://hotel.travel.ndeveloper.com/" xmlns:ns0="http://auto.travel.ndeveloper.com/">

    <!-- Import the client WSDL -->    <bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in travelReservation.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client" portType="tns:travelReservation" operation="process" variable="input" createInstance="yes" />


		<bpel:assign validate="no" name="makeResrvAsg">
			<bpel:copy>
				<bpel:from>
					<bpel:literal>
						<tns:makeRservation xmlns:tns="http://hotel.travel.ndeveloper.com/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
							<arg0>0</arg0>
							<arg1>2001-12-31T12:00:00</arg1>
							<arg2>2001-12-31T12:00:00</arg2>
							<arg3>arg3</arg3>

						</tns:makeRservation>
					</bpel:literal>

				</bpel:from>
				<bpel:to variable="makeReservationRequest" part="makeRservation"></bpel:to>


			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:roomNumber]]></bpel:query>
				</bpel:from>
				<bpel:to part="makeRservation" variable="makeReservationRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[arg0]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dateFrom]]></bpel:query>
				</bpel:from>
				<bpel:to part="makeRservation" variable="makeReservationRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[arg1]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dateTo]]></bpel:query>
				</bpel:from>
				<bpel:to part="makeRservation" variable="makeReservationRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[arg2]]></bpel:query>
				</bpel:to>
			</bpel:copy>
			<bpel:copy>
				<bpel:from part="payload" variable="input">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:name]]></bpel:query>
				</bpel:from>
				<bpel:to part="makeRservation" variable="makeReservationRequest">
					<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[arg3]]></bpel:query>
				</bpel:to>
			</bpel:copy>




		</bpel:assign>
		<bpel:invoke name="makeResrvIvk" partnerLink="hotelPL" operation="makeRservation" portType="ns:HotelService" inputVariable="makeReservationRequest" outputVariable="makeReservationResponse"></bpel:invoke>

		<bpel:if name="If">
			<bpel:condition><![CDATA[$makeReservationResponse.makeRservationResponse/return="true"]]></bpel:condition>
			<bpel:sequence>
				<bpel:assign validate="no" name="carResrvAsg">
                    <bpel:copy>
                        <bpel:from>
                            <bpel:literal>
                                <tns:makeCarReservation xmlns:tns="http://auto.travel.ndeveloper.com/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><arg0>arg0</arg0>
  <arg1>2001-12-31T12:00:00</arg1>
  <arg2>2001-12-31T12:00:00</arg2>

                                </tns:makeCarReservation>
                            </bpel:literal>
                        </bpel:from>
                        <bpel:to variable="carResrvRequest" part="makeCarReservation"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
						<bpel:from part="payload" variable="input">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:name]]>
                            </bpel:query>
                        </bpel:from>
						<bpel:to part="makeCarReservation" variable="carResrvRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[arg0]]>
                            </bpel:query>
                        </bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="input">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:dateFrom]]>
							</bpel:query>
						</bpel:from>
						<bpel:to part="makeCarReservation" variable="carResrvRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[arg1]]>
							</bpel:query>
						</bpel:to>
					</bpel:copy>
					<bpel:copy>
						<bpel:from part="payload" variable="input">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[tns:dateTo]]>
							</bpel:query>
						</bpel:from>
						<bpel:to part="makeCarReservation" variable="carResrvRequest">
							<bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                                <![CDATA[arg2]]>
							</bpel:query>
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
				<bpel:invoke name="carResrvIvk" partnerLink="carPL" operation="makeCarReservation" inputVariable="carResrvRequest" outputVariable="carResrvResponse"></bpel:invoke>
				<bpel:assign validate="no" name="resultAsg">

					<bpel:copy>
						<bpel:from>
							<bpel:literal xml:space="preserve"><tns:travelReservationResponse xmlns:tns="http://ndeveloper.com/bpel/travel" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:la reservacion esta lista</tns:result>
</tns:travelReservationResponse>
</bpel:literal>
						</bpel:from>
						<bpel:to part="payload" variable="output">
						</bpel:to>
					</bpel:copy>


				</bpel:assign>
			</bpel:sequence>
			<bpel:else>
				<bpel:assign validate="no" name="noHotelAsg">
					<bpel:copy>
						<bpel:from>
							<bpel:literal xml:space="preserve"><tns:travelReservationResponse xmlns:tns="http://ndeveloper.com/bpel/travel" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:result>tns:no hay espacios disponibles</tns:result>
</tns:travelReservationResponse></bpel:literal>
						</bpel:from>
						<bpel:to part="payload" variable="output">
						</bpel:to>
					</bpel:copy>
				</bpel:assign>
			</bpel:else>
		</bpel:if>








		
		<!-- Generate reply to synchronous request -->
		<bpel:reply name="replyOutput" partnerLink="client" portType="tns:travelReservation" operation="process" variable="output" />
	</bpel:sequence>    <bpel:import namespace="http://auto.travel.ndeveloper.com/"
		location="CarService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import namespace="http://hotel.travel.ndeveloper.com/"
		location="HotelService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="travelReservationArtifacts.wsdl"
		namespace="http://ndeveloper.com/bpel/travel" importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ======
	=========================================================== -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:travelReservation"
			myRole="travelReservationProvider" />
		<bpel:partnerLink name="hotelPL" partnerLinkType="tns:hotelPLType"
			partnerRole="nombreRole"></bpel:partnerLink>
		<bpel:partnerLink name="carPL" partnerLinkType="tns:carServicePLType"
			partnerRole="reserveCarRole"></bpel:partnerLink>
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input"
			messageType="tns:travelReservationRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output"
			messageType="tns:travelReservationResponseMessage">
		</bpel:variable>




		<bpel:variable name="makeReservationRequest"
			messageType="ns:HotelService_makeRservation"></bpel:variable>
		<bpel:variable name="makeReservationResponse"
			messageType="ns:HotelService_makeRservationResponse"></bpel:variable>






		<bpel:variable name="carResrvRequest" messageType="ns0:CarService_makeCarReservation"></bpel:variable>
		<bpel:variable name="carResrvResponse"
			messageType="ns0:CarService_makeCarReservationResponse"></bpel:variable>
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= --></bpel:process>

